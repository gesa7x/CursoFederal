M.tabtopics={init:function(Y,courseid,isZeroTab){Y.use('tabview',function(Y){var state_cookie="moodle_course_format_tabtopics_course_",tabview=new Y.TabView({srcNode:'#sections'});tabview.after('render',function(e){Y.one('#maincontainer').setStyle('display',null)});tabview.after('selectionChange',function(event){if(tabview.enableState===true){var target_tab=event.newVal,tab_index=target_tab.get('index'),expires=new Date();expires.setTime((expires.getTime()+60*60*1e3));Y.Cookie.set(state_cookie+courseid,tab_index,{expires:expires})}});tabview.render();counter=0;thisone=0;Y.all('#sections .yui3-tabview-list li').each(function(node){if(node.one('#marker'))thisone=counter;counter++});var tab_count=Y.all('#sections .yui3-tab')._nodes.length,url=document.URL.split('#');if(url.length>1&&(parseInt(url[1].split('-')[1])-1)<tab_count){var sectionnum=parseInt(url[1].split('-')[1])-1;tabview.selectChild(sectionnum)}else{var value=Y.Cookie.get(state_cookie+courseid);if(is_remember_last_tab_session&&value&&value<tab_count){tabview.selectChild(value)}else tabview.selectChild(thisone)};Y.all('p[id^=expandable_branch_]').each(function(node){node.on("click",function(e){var id=node.get("id"),tab=id.replace('expandable_branch_','');if(!isZeroTab){if(tab===1)return;tab-=1};tab-=1;tabview.selectChild(tab)})});tabview.enableState=true})}}